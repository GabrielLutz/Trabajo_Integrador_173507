<div class="container">
	<header class="page-header">
		<h1>Llamados</h1>
		<div class="estado-toggle" role="tablist" aria-label="Filtro de llamados">
			<button
				type="button"
				[class.active]="estadoSeleccionado === 'activos'"
				(click)="seleccionarEstado('activos')"
				[attr.aria-selected]="estadoSeleccionado === 'activos'"
			>
				Activos
				<span class="contador">{{ llamadosActivos.length }}</span>
			</button>
			<button
				type="button"
				[class.active]="estadoSeleccionado === 'inactivos'"
				(click)="seleccionarEstado('inactivos')"
				[attr.aria-selected]="estadoSeleccionado === 'inactivos'"
			>
				Inactivos
				<span class="contador">{{ llamadosInactivos.length }}</span>
			</button>
		</div>
	</header>

	<app-loading *ngIf="loading"></app-loading>
	<app-error-message *ngIf="error" [message]="error"></app-error-message>

	<div class="llamados-grid" *ngIf="!loading && !error && llamadosVisibles.length">
		<div class="llamado-card" *ngFor="let llamado of llamadosVisibles">
			<div class="card-header">
				<h3>{{ llamado.titulo }}</h3>
				<span
					class="badge"
					[class.urgente]="estadoSeleccionado === 'activos' && getDiasRestantes(llamado.fechaCierre) <= 7"
				>
					{{ estadoSeleccionado === 'activos' ? getDiasRestantes(llamado.fechaCierre) + ' d√≠as restantes' : llamado.estado }}
				</span>
			</div>

			<div class="card-body">
				<p>{{ llamado.descripcion }}</p>

				<div class="fechas">
					<div class="fecha">
						<span class="label">Apertura:</span>
						<span>{{ llamado.fechaApertura | date: 'dd/MM/yyyy' }}</span>
					</div>
					<div class="fecha">
						<span class="label">Cierre:</span>
						<span>{{ llamado.fechaCierre | date: 'dd/MM/yyyy' }}</span>
					</div>
				</div>
			</div>

			<div class="card-actions">
				<button class="btn btn-secondary" type="button" (click)="verDetalle(llamado.id)">
					Ver Detalle
				</button>
				<button
					class="btn btn-primary"
					type="button"
					(click)="inscribirse(llamado.id)"
					[disabled]="estadoSeleccionado === 'inactivos'"
				>
					{{ estadoSeleccionado === 'inactivos' ? 'No disponible' : 'Inscribirse' }}
				</button>
			</div>
		</div>
	</div>

	<div class="no-llamados" *ngIf="!loading && !error && !llamadosVisibles.length">
		<p>
			{{ estadoSeleccionado === 'activos'
				? 'No hay llamados activos en este momento.'
				: 'No hay llamados inactivos para mostrar.' }}
		</p>
	</div>
</div>
